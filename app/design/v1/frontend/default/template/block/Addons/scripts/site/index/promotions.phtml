
<section>
  <div class="promotions">
    <p>promociones</p>

      <?php if( ! empty( $this->promotions ) ): ?>
        <?php $separator = "/"; ?>
        <?php foreach( $this->promotions AS $promotion ): ?>
          <?php $description = App::module('Core')->getModel('Parser')->truncate_string($promotion['description'],50); ?>
          <?php if( $promotion['onclick_action']=='link' && ! empty($promotion['onclick_url'])  ):  ?>
            <?php $url = $promotion['onclick_url'];?>
          <?php else:?>
            <?php $url = App::www( App::xlat('empresas_singular') .$separator. $promotion['seo'] .$separator. App::xlat('promociones_singular') .$separator. $promotion['id'] );?>
          <?php endif;?>

          <article>

            <?php if( ! empty($promotion['picture']) && file_exists( WP.$promotion['path'].$promotion['picture'] ) ): ?>
              <a href="<?=$url?>">
                <img class="img-responsive" src="<?=App::www( $promotion['path'] .'mobile/'. $promotion['picture'] )?>" alt="<?=$promotion['author']?>" title="<?=$promotion['author']?>" />
              </a>
              <p><?=$description?></p>
            <?php else: ?>
              <p class="capitalize"> <span class="icon-certificate"></span> <a href="<?=$url?>"> <?=$description?> </a> </p>

            <?php endif;?>

          </article>

        <?php endforeach;?>

      <?php else:?>
        <article>
          <p>No existen promociones vigentes</p>
        </article>
      <?php endif;?>

  </div>
</section>

<?php 
/*
Array
(
  [0] => Array
    (
      [id] => 6
      [username] => toys@toys.com
      [author] => Toys de mazatlan
      [seo] => toys-de-mazatlan
      [picture] => 
      [path] => 
      [description] => Esta es una promocion sin imagenes, para ver como se conjugan
      [city] => mazatlan
      [city_name] => Mazatlan
      [state] => 
      [state_name] => Sinaloa
      [country] => mexico
      [country_name] => MÃ©xico
      [created] => 0000-00-00 00:00:00
      [start] => 2013-08-03
      [finish] => 2013-08-13
      [main] => yes
      [onclick_action] => expand
      [onclick_url] => 
      [status] => enabled
    )
*/
?>
